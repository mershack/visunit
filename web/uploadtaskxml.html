<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Uploading a new task XML file</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="utils.js" /></script>
    <script type="text/javascript" src="taskcreation.js"></script>

    <style type="text/css">
        body{
            margin: 50px;
            width:750px;
        }
        .innerBox{                
            padding-left: 50px;
        }
        .grayBackground{

            background-color: #F0F0F0  ;
            margin: 1px;
            padding: 1px;
        }
        td{
            padding-left: 10px;
            padding-right: 10px;
            margin: 15px;
        }
        .leftSpacing1{
            margin-left: 50px;
            margin-bottom: 0px !important
        }

        .divCenter{
            margin-left: 40%;
        }  
        .center{

            margin-left: auto;
            margin-right: auto;

        }
        .errorNotices{
            color: red !important;

            /*background-color: yellow;*/
            display: none;
        }
        #nameAvailable{
            color: green;
        }
        #nameUnavailable{
            color:red;
        }

    </style>

    <script type="text/javascript">

        window.onload = function() {
            setUserId();
        };

        function uploadTaskFile() {

            var thefile = document.getElementById("thefile").files;
            var userid = document.getElementById("userid").value;

            //var url = "DatasetManager?command=add" + "&userid=" + userid;



            var formData = new FormData();

            var errorExists = false;

            var taskShortName = document.getElementById("taskShortname").value;

            if (taskShortName === "") {
                document.getElementById("nameError").style.display = "block";
                errorExists = true;
            }


            //check if no file has been added
            if (thefile.length === 0) {
                //show the errorNotices
                document.getElementById("filesError").style.display = "block";
                errorExists = true;
            }

            if (errorExists === false)
            {
                var url = "TaskCreator?command=uploadNewTaskXMLFile" + "&userid=" + userid
                        + "&taskShortName=" + taskShortName;

                formData.append("File", thefile[0]);


                var xmlHttpRequest = getXMLHttpRequest();
                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                       if(xmlHttpRequest.responseText === "successful"){
                           window.location ="task-xml-upload-successful.html";
                       }
                       else{
                           alert("Invalid XML file.");
                       }
                        //  window.location = "add-dataset-success.html";
                    }
                };
                xmlHttpRequest.open("POST", url, false);
                xmlHttpRequest.send(formData);

            }
        }

    </script>
</head>
<body>
    <div>
        <h2>Uploading a new task XML file  </h2>
        <hr />

        <br/> <br/>

        <div class="errorNotices" id="nameError">
            <p>
                ** The task short name is Empty.
            </p>
        </div>

        <table class="center grayBackground">
            <tr>
                <td>
                    <p> Provide a short name for this task  &nbsp; &nbsp; &nbsp;
                        <input type="text" size="20" id="taskShortname" value="" class="right"

                               onblur="checkShortNameAvailability();" />

                        <span id="nameAvailabilityChecking" style="display:none;">
                            <span id="nameAvailable" style="display:none;" class="center"> (Name is Available)</span>
                            <span id="nameUnavailable" style="display:none;" class="center"> (Name is not Available, try another)</span>
                        </span>
                    </p>
                </td>
            </tr>
        </table>

        <div class="innerBox">
            <div class="errorNotices" id="filesError">
                <p>
                    ** No File has been added.
                </p>
            </div>
            <table class="center">
                <tr  class="grayBackground">
                    <td>
                        <p>
                            Load XML File
                            <span class="leftSpacing1">
                                <input type="file" name="thefile" id="thefile"/>
                            </span>  
                        </p>
                    </td>
                </tr>
            </table>

            <br/> <br/>
            <div class="divCenter">
                <input type="button" value="Submit Task File" onclick="uploadTaskFile();" class="center" />
            </div>
        </div>
        <hr/>

    </div>
    <input type="hidden" id="userid" value="user2" /> 

</body>
</html>
