<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Uploading a new task XML file</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="taskinstances.js"></script>
        <script type="text/javascript" src="question-properties.js"></script>
        <script type="text/javascript" src="utils.js"></script>
        <script type="text/javascript" src="setup.js"></script>
        <script type="text/javascript" src="addviewers.js"></script>

        <style type="text/css">
            body{
                margin: 50px;
                width:750px;
            }
            .innerBox{                
                padding-left: 50px;
            }
            .grayBackground{

                background-color: #F0F0F0  ;
                margin: 1px;
                padding: 1px;
            }
            td{
                padding-left: 10px;
                padding-right: 10px;
                margin: 15px;
            }
            .leftSpacing1{
                margin-left: 50px;
                margin-bottom: 0px !important
            }

            .divCenter{
                margin-left: 40%;
            }  
            .center{

                margin-left: auto;
                margin-right: auto;

            }
            .errorNotices{
                color: red !important;

                /*background-color: yellow;*/
                display: none;
            }
            #nameAvailable{
                color: green;
            }
            #nameUnavailable{
                color:red;
            }
            .refreshIconSmall{
                margin-left: 10px;
                margin-right: 10px;
                width: 20px;
                height: 15px;
            }
            #viewerRow{
                display: none;
            }

        </style>

        <script type="text/javascript">

            window.onload = function() {
                setUserId(preparePage);
            };

            function uploadTaskInstanceFile() {

                var thefile = document.getElementById("thefile").files;
                var userid = document.getElementById("userid").value;

                var formData = new FormData();

                var errorExists = false;


                //get the dataset
                var dataset = document.getElementById("dataset1").value;
                //get the viewer
                var viewer = document.getElementById("existingViewerDirName1").value;
                //get the task
                var task = document.getElementById("taskType1").value;

                //if a dataset has not been selected and the checkbox for no dataset has not been selected
                if (dataset === "" && document.getElementById("datasetCheckBox").checked === false) {
                    errorExists = true;
                    document.getElementById("datasetError").style.display = "block";
                }
                else {
                    document.getElementById("datasetError").style.display = "none";
                }
                //check a viewer has not been selected and there is no dataset
                if (viewer === "" && document.getElementById("datasetCheckBox").checked === true) {
                    errorExists = true;
                    document.getElementById("viewerError").style.display = "block";
                }
                else {
                    document.getElementById("viewerError").style.display = "none";
                }

                //check if a task has not been selected
                if (task === "") {
                    errorExists = true;
                    document.getElementById("taskError").style.display = "block";
                }
                else {
                    document.getElementById("taskError").style.display = "none";
                }

                //check if no file has been added
                if (thefile.length === 0) {
                    //show the errorNotices
                    document.getElementById("filesError").style.display = "block";
                    errorExists = true;
                }

                if (errorExists === false)
                {
                    var url = "TaskCreator?command=uploadNewTaskInstancesXMLFile" + "&userid=" + userid
                            + "&task=" + task
                            + "&dataset="+dataset
                            + "&viewer="+viewer;

                    formData.append("File", thefile[0]);


                    var xmlHttpRequest = getXMLHttpRequest();
                    xmlHttpRequest.onreadystatechange = function()
                    {
                        if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                        {
                            if (xmlHttpRequest.responseText === "successful") {
                                window.location = "task-instance-xml-upload-successful.html";
                            }
                            else {
                                alert("Invalid XML file.");
                            }                            
                        }
                    };
                    xmlHttpRequest.open("POST", url, false);
                    xmlHttpRequest.send(formData);

                }
            }

            function noDatasetCheckboxClicked(elem) {
                if (elem.checked === true) {
                    document.getElementById("viewerRow").style.display = "block";
                    document.getElementById("dataset1").selectedIndex = 0;
                    document.getElementById("dataset1").setAttribute("disabled", true);
                }
                else {
                    document.getElementById("viewerRow").style.display = "none";
                    document.getElementById("dataset1").removeAttribute("disabled");
                }
            }

        </script>
    </head>
    <body>
        <div>
            <h2>Uploading a new task Instance XML file  </h2>
            <hr />

            <br/> <br/>

            <!-- They should select the task at least. -->

            <table class="center" id="datasetsTable">            
                <tr class="grayBackground">
                    <td>
                        <p class="errorNotices" id="datasetError">
                            ** No Dataset has been selected
                        </p>
                        <p>   
                            Select the Dataset 
                            <select name="dataset" id="dataset1" onchange="datasetChanged(this);">
                                <option value ="">Select One</option> 
                            </select>
                            <!--
                            <img src="images/refresh-icon.png" title="Refresh Datasets" 
                                 alt="Refresh Datasets" onclick="loadDatasets()" class="refreshIconSmall"/>  -->

                        </p>

                        <p>
                            <input id="datasetCheckBox" type="checkbox" onclick="noDatasetCheckboxClicked(this);"/> Task instances will not be based on a dataset.
                        </p>

                    </td>

                </tr>
                <tr id="viewerRow" class="grayBackground">
                    <td>
                        <p class="errorNotices" id="viewerError">
                            ** No viewer has been selected.                            
                        </p>

                        <p>
                            Select the viewer
                            <select id="existingViewerDirName1">

                            </select>
                            <!--  <img src="images/refresh-icon.png" title="Refresh Viewer Directories" 
                                       alt="Refresh Viewer Directories" 
                                       onclick="getExistingDirectoryNamesAndHTMLFilenames();" 
                                       class="refreshIconSmall"/>  -->

                        </p>

                    </td>
                </tr>
                <tr class="grayBackground">
                    <td>
                        <p class="errorNotices" id="taskError">
                            ** No task has been selected.
                        </p>
                        <p>
                            Select the Task
                            <span class="questionNumberOdd" id="qnDiv">

                            </span>

                        </p>


                    </td>
                </tr>
                <tr  class="grayBackground">
                    <td>
                        <div class="errorNotices" id="filesError">
                            <p>
                                ** No File has been added.
                            </p>
                        </div>
                        <p>
                            Load XML File
                            <span class="leftSpacing1">
                                <input type="file" name="thefile" id="thefile"/>
                            </span>  
                        </p>
                    </td>
                </tr>

            </table>    

            <div class="innerBox">
                <br/> <br/>
                <div class="divCenter">
                    <input type="button" value="Submit Task File" onclick="uploadTaskInstanceFile();" class="center" />
                </div>
            </div>
            <hr/>

        </div>
        <input type="hidden" id="userid" value="user2" /> 

    </body>
</html>
